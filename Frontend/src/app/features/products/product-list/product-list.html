<app-header></app-header>

<!-- Collection Navigation Bar -->
<nav class="collection-nav">
  <div class="collection-nav-container">
    <button 
      class="collection-btn"
      [class.active]="selectedCollection === ''"
      (click)="onCollectionChange('')">
      All Products
    </button>
    <button 
      *ngFor="let collection of collections"
      class="collection-btn"
      [class.active]="selectedCollection === collection"
      (click)="onCollectionChange(collection)">
      {{ collection }}
    </button>
  </div>
</nav>

<div class="product-list-container">
  <!-- Mobile filter toggle -->
  <button class="mobile-filter-toggle" (click)="toggleSidebar()">
    <span>Filters</span>
  </button>

  <div class="main-content">
    <!-- Sidebar -->
    <aside class="sidebar" [class.open]="sidebarOpen">
      <div class="filters-header">
        <h2>Filters</h2>
        <button class="clear-all" (click)="clearAllFilters()">CLEAR ALL</button>
      </div>

      <!-- Categories -->
      <div class="filter-section">
        <div class="filter-header">
          <h3>CATEGORIES</h3>
        </div>
        <div class="filter-options">
          <div *ngFor="let category of categories" class="filter-option">
            <input type="checkbox" 
                   [id]="'cat-' + category"
                   [checked]="selectedCategories.includes(category)"
                   (change)="onCategoryChange(category, $event.target.checked)">
            <label [for]="'cat-' + category">{{ category }}</label>
          </div>
        </div>
      </div>

      <!-- Price -->
      <div class="filter-section">
        <div class="filter-header">
          <h3>PRICE</h3>
        </div>
        <div class="price-range">
          <div class="price-slider">
            <input type="range" 
                   [(ngModel)]="minPrice" 
                   [min]="0" 
                   [max]="1000" 
                   (ngModelChange)="onPriceChange()"
                   class="slider">
            <input type="range" 
                   [(ngModel)]="maxPrice" 
                   [min]="0" 
                   [max]="1000" 
                   (ngModelChange)="onPriceChange()"
                   class="slider">
          </div>
          <div class="price-display">
            <span>â‚¹{{ minPrice }}</span>
            <span>to</span>
            <span>â‚¹{{ maxPrice }}</span>
          </div>
        </div>
      </div>



      <!-- Discount -->
      <div class="filter-section">
        <div class="filter-header">
          <h3>DISCOUNT</h3>
        </div>
        <div class="filter-options">
          <div *ngFor="let discount of discounts" class="filter-option">
            <input type="checkbox" 
                   [id]="'discount-' + discount.value"
                   [checked]="selectedDiscounts.includes(discount.value)"
                   (change)="onDiscountChange(discount.value, $event.target.checked)">
            <label [for]="'discount-' + discount.value">{{ discount.label }}</label>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main content area -->
    <main class="content">
      <!-- Top bar -->
      <div class="top-bar">
        <div class="results-count">
          {{ filteredProducts.length }} products found
        </div>
        <div class="sort-controls">
          <select [(ngModel)]="sortBy" (ngModelChange)="onSortChange()" class="sort-select">
            <option value="popular">Sort by Popular</option>
            <option value="newest">Sort by Newest</option>
            <option value="price-low">Price: Low to High</option>
            <option value="price-high">Price: High to Low</option>
          </select>
        </div>
      </div>

      <!-- Loading state -->
      <div *ngIf="loading" class="loading">
        <div class="spinner"></div>
        <p>Loading products...</p>
      </div>

      <!-- Product grid -->
      <div *ngIf="!loading" class="product-grid">
        <div *ngFor="let product of filteredProducts" 
             class="product-card" 
             (click)="onProductClick(product.id)">
          <div class="product-image">
            <img [src]="product.imageUrl" [alt]="product.name" (error)="product.imageUrl='assets/images/no-image.png'">
          </div>
          <div class="product-info">
            <div class="category">{{ product.category }}</div>
            <h3 class="product-name">{{ product.name }}</h3>
            <div class="price-section">
              <div class="current-price">â‚¹{{ product.price.toFixed(2) }}</div>
              <div *ngIf="product.originalPrice && product.originalPrice > product.price" class="price-details">
                <span class="original-price">â‚¹{{ product.originalPrice.toFixed(2) }}</span>
                <span class="discount">{{ getDiscountPercentage(product) }}% OFF</span>
              </div>
            </div>
            <button class="add-to-cart-btn" (click)="addToCart(product, $event)">
              <i class="cart-icon">ðŸ›’</i>
              <span>Add to Cart</span>
            </button>
            <div class="rating">
              <div class="stars">
                <span *ngFor="let star of getStars(product.rating)" 
                      class="star" 
                      [class.filled]="star === 'filled'">â˜…</span>
              </div>
              <span class="rating-text">{{ product.rating }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty state -->
      <div *ngIf="!loading && filteredProducts.length === 0" class="empty-state">
        <p>No products found matching your criteria.</p>
      </div>
    </main>
  </div>
</div>
<app-footer></app-footer>
