<app-header></app-header>

<div class="container mx-auto py-8 bg-white font-sans mt-2">
  <div class="max-w-4xl mx-auto">
    <header class="mb-8 text-center bg-gradient-to-r from-green-50 to-blue-50 mx-6 py-6 rounded-lg">
      <div class="flex items-center justify-center space-x-4">
        <div class="w-12 h-12 bg-gradient-to-r from-green-600 to-blue-600 rounded-full flex items-center justify-center">
          <i class="bi bi-credit-card text-white text-lg"></i>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-0">Secure Payment</h1>
          <p class="text-gray-600 text-sm">Complete your purchase safely</p>
        </div>
      </div>
    </header>

    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Payment Form -->
      <div class="lg:w-2/3">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <h3 class="text-xl font-semibold mb-6 flex items-center">
            <i class="bi bi-shield-check text-green-600 mr-2"></i>
            Choose Payment Method
          </h3>

          <!-- Payment Method Selection -->
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <button type="button" 
                    class="p-4 border-2 rounded-lg transition-all duration-200 flex flex-col items-center"
                    [class.border-blue-500]="selectedPaymentMethod === 'card'"
                    [class.bg-blue-50]="selectedPaymentMethod === 'card'"
                    [class.border-gray-200]="selectedPaymentMethod !== 'card'"
                    (click)="selectPaymentMethod('card')">
              <i class="bi bi-credit-card text-2xl mb-2" 
                 [class.text-blue-600]="selectedPaymentMethod === 'card'"
                 [class.text-gray-400]="selectedPaymentMethod !== 'card'"></i>
              <span class="font-medium">Credit/Debit Card</span>
            </button>

            <button type="button" 
                    class="p-4 border-2 rounded-lg transition-all duration-200 flex flex-col items-center"
                    [class.border-blue-500]="selectedPaymentMethod === 'upi'"
                    [class.bg-blue-50]="selectedPaymentMethod === 'upi'"
                    [class.border-gray-200]="selectedPaymentMethod !== 'upi'"
                    (click)="selectPaymentMethod('upi')">
              <i class="bi bi-phone text-2xl mb-2"
                 [class.text-blue-600]="selectedPaymentMethod === 'upi'"
                 [class.text-gray-400]="selectedPaymentMethod !== 'upi'"></i>
              <span class="font-medium">UPI</span>
            </button>

            <button type="button" 
                    class="p-4 border-2 rounded-lg transition-all duration-200 flex flex-col items-center"
                    [class.border-blue-500]="selectedPaymentMethod === 'netbanking'"
                    [class.bg-blue-50]="selectedPaymentMethod === 'netbanking'"
                    [class.border-gray-200]="selectedPaymentMethod !== 'netbanking'"
                    (click)="selectPaymentMethod('netbanking')">
              <i class="bi bi-bank text-2xl mb-2"
                 [class.text-blue-600]="selectedPaymentMethod === 'netbanking'"
                 [class.text-gray-400]="selectedPaymentMethod !== 'netbanking'"></i>
              <span class="font-medium">Net Banking</span>
            </button>



            <button type="button" 
                    class="p-4 border-2 rounded-lg transition-all duration-200 flex flex-col items-center"
                    [class.border-blue-500]="selectedPaymentMethod === 'emi'"
                    [class.bg-blue-50]="selectedPaymentMethod === 'emi'"
                    [class.border-gray-200]="selectedPaymentMethod !== 'emi'"
                    (click)="selectPaymentMethod('emi')">
              <i class="bi bi-calendar-check text-2xl mb-2"
                 [class.text-blue-600]="selectedPaymentMethod === 'emi'"
                 [class.text-gray-400]="selectedPaymentMethod !== 'emi'"></i>
              <span class="font-medium">EMI</span>
            </button>
          </div>

          <!-- Payment Forms -->
          <form #paymentForm="ngForm" (ngSubmit)="processPayment(paymentForm)">
            
            <!-- Card Payment Form -->
            <div *ngIf="selectedPaymentMethod === 'card'" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Card Holder Name</label>
                <input type="text" 
                       [(ngModel)]="cardHolderName" 
                       name="cardHolderName"
                       required
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       placeholder="Enter cardholder name">
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Card Number</label>
                <input type="text" 
                       [(ngModel)]="cardNumber" 
                       name="cardNumber"
                       required
                       maxlength="19"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       placeholder="1234 5678 9012 3456">
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Expiry Date</label>
                  <input type="text" 
                         [(ngModel)]="expiryDate" 
                         name="expiryDate"
                         required
                         placeholder="MM/YY"
                         maxlength="5"
                         class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">CVV</label>
                  <input type="password" 
                         [(ngModel)]="cvv" 
                         name="cvv"
                         required
                         maxlength="4"
                         class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                         placeholder="123">
                </div>
              </div>
            </div>

            <!-- UPI Payment Form -->
            <div *ngIf="selectedPaymentMethod === 'upi'" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">UPI ID</label>
                <input type="text" 
                       [(ngModel)]="upiId" 
                       name="upiId"
                       required
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                       placeholder="yourname@paytm">
              </div>
            </div>

            <!-- Net Banking Form -->
            <div *ngIf="selectedPaymentMethod === 'netbanking'" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Bank</label>
                <select [(ngModel)]="selectedBank" 
                        name="selectedBank"
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  <option value="">Choose your bank</option>
                  <option value="sbi">State Bank of India</option>
                  <option value="hdfc">HDFC Bank</option>
                  <option value="icici">ICICI Bank</option>
                  <option value="axis">Axis Bank</option>
                  <option value="pnb">Punjab National Bank</option>
                </select>
              </div>
            </div>



            <!-- EMI Payment Form -->
            <div *ngIf="selectedPaymentMethod === 'emi'" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">EMI Tenure</label>
                <select [(ngModel)]="selectedEmiTenure" 
                        name="selectedEmiTenure"
                        required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                  <option value="">Select tenure</option>
                  <option value="3">3 months (₹{{ (totalAmount/3).toFixed(2) }}/month)</option>
                  <option value="6">6 months (₹{{ (totalAmount/6).toFixed(2) }}/month)</option>
                  <option value="9">9 months (₹{{ (totalAmount/9).toFixed(2) }}/month)</option>
                  <option value="12">12 months (₹{{ (totalAmount/12).toFixed(2) }}/month)</option>
                </select>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 mt-8" *ngIf="paymentStep === 1">
              <button type="button" 
                      (click)="goBack()"
                      class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                <i class="bi bi-arrow-left mr-2"></i>
                Back to Summary
              </button>
              
              <button type="submit" 
                      [disabled]="isProcessing"
                      class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 disabled:opacity-50">
                <span *ngIf="!isProcessing">
                  <i class="bi bi-lock-fill mr-2"></i>
                  Pay ₹{{ totalAmount.toFixed(2) }}
                </span>
                <span *ngIf="isProcessing">
                  <i class="bi bi-arrow-repeat animate-spin mr-2"></i>
                  Processing...
                </span>
              </button>
            </div>
          </form>

          <!-- Payment Processing Status -->
          <div *ngIf="paymentStep === 2" class="text-center py-12">
            <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="bi bi-arrow-repeat animate-spin text-blue-600 text-3xl"></i>
            </div>
            <h3 class="text-xl font-semibold mb-2">Processing Payment</h3>
            <p class="text-gray-600 mb-4">Transaction ID: {{ transactionId }}</p>
            <div class="w-64 bg-gray-200 rounded-full h-2 mx-auto">
              <div class="bg-blue-600 h-2 rounded-full animate-pulse" style="width: 70%"></div>
            </div>
          </div>

          <!-- Payment Success -->
          <div *ngIf="paymentStep === 3" class="text-center py-12">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="bi bi-check-circle-fill text-green-600 text-3xl"></i>
            </div>
            <h3 class="text-xl font-semibold text-green-600 mb-2">Payment Successful!</h3>
            <p class="text-gray-600 mb-2">Transaction ID: {{ transactionId }}</p>
            <p class="text-gray-600">Redirecting to order history...</p>
          </div>


        </div>
      </div>

      <!-- Order Summary -->
      <div class="lg:w-1/3" *ngIf="paymentStep === 1">
        <div class="bg-white rounded-lg shadow-lg p-6 sticky top-24">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="bi bi-receipt text-blue-600 mr-2"></i>
            Order Summary
          </h3>

          <div class="space-y-3 mb-4">
            <div *ngFor="let item of orderDetails" class="flex justify-between items-center py-2 border-b border-gray-100">
              <div class="flex-1">
                <p class="font-medium text-sm">{{ item.name }}</p>
                <p class="text-gray-500 text-xs">Qty: {{ item.quantity }}</p>
              </div>
              <span class="font-semibold">₹{{ (item.price * (item.quantity || 1)).toFixed(2) }}</span>
            </div>
          </div>

          <div class="border-t pt-4 space-y-2">
            <div class="flex justify-between">
              <span class="text-gray-600">Subtotal</span>
              <span>₹{{ totalAmount.toFixed(2) }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Shipping</span>
              <span class="text-green-600">FREE</span>
            </div>
            <div class="flex justify-between font-bold text-lg border-t pt-2">
              <span>Total</span>
              <span class="text-green-600">₹{{ totalAmount.toFixed(2) }}</span>
            </div>
          </div>

          <div class="mt-6 p-4 bg-green-50 rounded-lg">
            <div class="flex items-center text-green-700 text-sm">
              <i class="bi bi-shield-check mr-2"></i>
              <span>Your payment is secured with 256-bit SSL encryption</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Status Summary -->
      <div class="lg:w-1/3" *ngIf="paymentStep > 1">
        <div class="bg-white rounded-lg shadow-lg p-6 sticky top-24">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <i class="bi bi-receipt text-blue-600 mr-2"></i>
            Payment Details
          </h3>
          
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-gray-600">Amount</span>
              <span class="font-semibold">₹{{ totalAmount.toFixed(2) }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Method</span>
              <span class="font-semibold capitalize">{{ selectedPaymentMethod }}</span>
            </div>
            <div class="flex justify-between" *ngIf="transactionId">
              <span class="text-gray-600">Transaction ID</span>
              <span class="font-semibold text-sm">{{ transactionId }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600">Status</span>
              <span class="font-semibold" 
                    [class.text-blue-600]="paymentStatus === 'processing'"
                    [class.text-green-600]="paymentStatus === 'success'">
                {{ paymentStatus | titlecase }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>